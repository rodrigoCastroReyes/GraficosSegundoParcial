<!DOCTYPE html>
<html>

<head>
    <title>Proyecto Tres Graficos por Computadora</title>
    <script type="text/javascript" src="lib_three/build/three.js"></script>
    <script type="text/javascript" src="jquery-1.9.0.js"></script>
    <script type="text/javascript" src="lib_three/examples/js/libs/dat.gui.min.js"></script>
    <script type="text/javascript" src="lib_three/examples/js/libs/stats.min.js"></script>
    <script type="text/javascript" src="Modelos/Bird.js"></script>
    <style>
        body{
            /* set margin to 0 and overflow to hidden, to go fullscreen */
            margin: 0;
            overflow: hidden;
        }
    </style>
</head>
<body>

<div id="Stats-output"></div>
<!-- Div which will hold the Output -->
<div id="WebGL-output"></div>
<!-- Javascript code that runs our Three.js examples -->
<script type="text/javascript">

    // once everything is loaded, we run our Three.js stuff.
    $(function () {

        var stats = initStats();

        // create a scene, that will hold all our elements such as objects, cameras and lights.
        var scene = new THREE.Scene();

        // create a camera, which defines where we're looking at.
        var camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 10, 1000);

        // create a render and set the size
        var renderer = new THREE.WebGLRenderer();

        renderer.setClearColorHex(0xEEEEEE, 1.0);
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMapEnabled = true;

        // create the ground plane

        floorWidth=280;
        floorHeight=230;
        var floorGeometry = new THREE.PlaneGeometry(floorWidth,floorHeight,1,1);
        // PlaneGeometry(width, height, widthSegments, heightSegments) widthSegments y heightSegments son parametros opcionales y son 1 por defecto

        //var planeMaterial =    new THREE.MeshLambertMaterial({color: 0xffffff});
        var floorTexture= THREE.ImageUtils.loadTexture('imagenes/mad.jpg');
        floorTexture.wrapS=floorTexture.wrapT=THREE.RepeatWrapping;
        var floorMaterial = new THREE.MeshPhongMaterial({map:floorTexture});
        floorMaterial.bumpScale=1;


        var floor = new THREE.Mesh(floorGeometry,floorMaterial);
        floor.receiveShadow  = true;//indica que el plano recibira sombras

        // rotate and position the plane
        floor.rotation.x=-0.5*Math.PI;
        floor.position.x=0;
        floor.position.y=0;
        floor.position.z=0;

        // add the plane to the scene
        scene.add(floor);

        var axes=new THREE.AxisHelper(60);
        scene.add(axes);

        //pared tracera
        wallHeight=90;
        var wallGeometry = new THREE.CubeGeometry(floorWidth,wallHeight,5);
        var wallTexture= THREE.ImageUtils.loadTexture('imagenes/text_ladrillo.jpg');
        wallTexture.wrapS=wallTexture.wrapT=THREE.RepeatWrapping;
        
        //var bump=THREE.ImageUtils.loadTexture('imagenes/bump_ladrillo.jpg');
        //bump.wrapS=bump.wrapT=THREE.RepeatWrapping;
        //bump.repeat.set(5,3);
        //wallTexture.repeat.set(5,2);
        wallGeometry.computeVertexNormals();
        
        var wallMaterial = new THREE.MeshPhongMaterial({map:wallTexture});

        var wall=new THREE.Mesh(wallGeometry,wallMaterial);
        wall.position.x=0;
        wall.position.y=45;
        wall.position.z=-floorHeight/2;
        scene.add(wall);

        wallWeight=230
        //pared dos
        var frontalWallGeometry=new THREE.CubeGeometry(wallWeight,wallHeight,5);
        var frontalWallTexture= THREE.ImageUtils.loadTexture('imagenes/text_ladrillo.jpg');
        frontalWallTexture.wrapS=frontalWallTexture.wrapT=THREE.RepeatWrapping;
        frontalWallGeometry.computeVertexNormals();  
        var frontalWallMaterial = new THREE.MeshPhongMaterial({map:frontalWallTexture});
        var frontalWall=new THREE.Mesh(frontalWallGeometry,frontalWallMaterial);

        frontalWall.rotation.y=-0.5*Math.PI;
        frontalWall.position.x= floorWidth/2 ;
        frontalWall.position.y=45;
        frontalWall.position.z=-floorHeight/2 + 115;

        scene.add(frontalWall);

        initWindow('imagenes/bosque.jpg',60); //a単ade la ventana a la escena le envia una ruta del fondo y la posicion en X en la escena
        initWindow('imagenes/sol.jpg',180);

        initPortrait();
        initWalls();//a単ade las paredes a la escena
        initBalls();//a単aden las pelotas
        initTree();

        // posiciones de la camara
        camera.position.x = 0;
        camera.position.y = 100;
        camera.position.z = 250;
        camera.lookAt(scene.position);

        // Luces:
        var ambientLight =  new THREE.AmbientLight(0xffffff);
        scene.add(ambientLight);

        //luz desde la ventana 1
        var spotLight = new THREE.SpotLight( 0x838d8c);
        spotLight.position.set( -45, 70, -50 );
       // spotLight.castShadow = true;
        scene.add( spotLight );

        //luz desde la ventana 1
        var spotLightDos = new THREE.SpotLight( 0x838d8c);
        spotLightDos.position.set( 65, 70, -50 );
        spotLightDos.castShadow = true;
        spotLightDos.intensity=3;
        scene.add( spotLightDos );

        var light = new THREE.PointLight( 0xfffbb7,0.8, 100 );
        light.position.set( 65, 70, -50 );
        scene.add( light );

         var light = new THREE.PointLight( 0xfffbb7,0.8, 100 );
        light.position.set(-45, 70, -50 );
        scene.add( light );


        var material = new THREE.MeshBasicMaterial({color: 0x0000ff});
        var radius = 5;
        var segments = 32;


        var spotLightTres = new THREE.SpotLight( 0xffffff);
        spotLightTres.position.set( 0, 90, 80 );
        spotLightTres.intensity = 0.5;
        spotLightTres.castShadow = true;
        //scene.add( spotLightTres );


        var circleGeometry = new THREE.CircleGeometry( radius, segments );              
        var circle = new THREE.Mesh( circleGeometry, material );
        circle.position.x=spotLightDos.position.x;
        circle.position.y=spotLightDos.position.y;
        circle.position.z=spotLightDos.position.z;
       // scene.add( circle )


        bird=new THREE.Mesh( new Bird(), new THREE.MeshBasicMaterial( { color:0x000000, side: THREE.DoubleSide,transparent:true } ) );

        bird.position.y=40;
        bird.position.z=-floorHeight/2 +5;
        //scene.add(bird);

        var phase=0;

        // add the output of the renderer to the html element
        $("#WebGL-output").append(renderer.domElement);

        render();  

        function render(){
            
            phase=0.5+phase;
            bird.position.x=phase;

            bird.geometry.vertices[ 5 ].y = bird.geometry.vertices[ 4 ].y = Math.sin( phase ) * 5;
            bird.geometry.verticesNeedUpdate=true;
            requestAnimationFrame(render);
            renderer.render(scene, camera);

        }

        function createWall(){//crea un pared peque単a
            var cubeGeometry = new THREE.CubeGeometry(36,20,4);
            var cubeTexture=THREE.ImageUtils.loadTexture('imagenes/paredes_pequenias.jpg');
            cubeTexture.wrapS=cubeTexture.wrapT=THREE.RepeatWrapping;
            //cubeTexture.repeat.set(2,2);
            var cubeMaterial = new THREE.MeshPhongMaterial({map:cubeTexture});
            var cube = new THREE.Mesh(cubeGeometry, cubeMaterial);
            cube.castShadow=true;
            return cube;
        }

        function creatBall(rutaTextura){//crea una pelota
            var sphereGeometry = new THREE.SphereGeometry(10,20,20);
            var sphereTexture = THREE.ImageUtils.loadTexture(rutaTextura);
            var sphereMaterial = new THREE.MeshPhongMaterial({map:sphereTexture});
            var sphere = new THREE.Mesh(sphereGeometry,sphereMaterial);
            sphere.castShadow=true;
            return sphere;        
        }


        function createBaseBall(){
            var ballGeometry = new THREE.SphereGeometry(10,20,20);
            var ballTexture = THREE.ImageUtils.loadTexture('imagenes/marmol.jpg');
            var bump = THREE.ImageUtils.loadTexture('imagenes/textura_golf.jpg');
            var ballMaterial = new THREE.MeshPhongMaterial({map:ballTexture,bumpMap:bump,bumpScale:0.2});
            var ball=new THREE.Mesh(ballGeometry,ballMaterial);
           // ball.receiveShadow=true
            ball.castShadow=true
            return ball;
        }


        function initBalls(){
            var ball1=createBaseBall();
            ball1.position.x=40;
            ball1.position.y=10;
            ball1.position.z=0;
            scene.add(ball1);

            var ball2=creatBall('imagenes/piedra.jpg');
            ball2.position.x=-45;
            ball2.position.y=10;
            ball2.position.z=20;
            scene.add(ball2);


            var ball3=creatBall('imagenes/mad.jpg');
            ball3.position.x=0;
            ball3.position.y=10;
            ball3.position.z=55;
            scene.add(ball3);
        }

        function initWindow(path,distance){

            WindowWeight=80
            WindowHight=60
            positionX=-floorHeight/2 + distance;
            positionY=50

            var windowGeometry=new THREE.PlaneGeometry(WindowWeight,WindowHight,1,1);
            var windowTexture= THREE.ImageUtils.loadTexture(path);
            var windowMaterial = new THREE.MeshPhongMaterial({map:windowTexture});
            var windowMesh= new THREE.Mesh(windowGeometry,windowMaterial);
            windowMesh.position.x=positionX;
            windowMesh.position.y=positionY;
            windowMesh.position.z=-floorHeight/2 + 5;
            scene.add(windowMesh);

            var vidrioGeometry=new THREE.PlaneGeometry(WindowWeight,WindowHight,1,1);
            var vidrioTexture= THREE.ImageUtils.loadTexture('imagenes/vidrioVentana.jpg');
            var vidrioMaterial = new THREE.MeshLambertMaterial({opacity:0.6,transparent:true,map:vidrioTexture});
            var vidrioMesh= new THREE.Mesh(vidrioGeometry,vidrioMaterial);
            vidrioMesh.position.x=positionX;
            vidrioMesh.position.y=positionY;
            vidrioMesh.position.z=-floorHeight/2 + 5;
            scene.add(vidrioMesh);

            var marcoGeometry = new THREE.PlaneGeometry(WindowWeight,WindowHight,1,1);
            var marcoTexture= THREE.ImageUtils.loadTexture('imagenes/ventana.png');
            var marcoMaterial = new THREE.MeshPhongMaterial({transparent:true,map:marcoTexture});
            var marco=new THREE.Mesh(marcoGeometry,marcoMaterial);
            marco.position.x=positionX;
            marco.position.y=positionY;
            marco.position.z=-floorHeight/2 + 5;
            scene.add(marco);
        }

        function initWalls(){
            var paredUno=createWall();
            paredUno.position.x=-35;
            paredUno.position.y=10;
            paredUno.position.z=70;
            scene.add(paredUno);

            var paredDos=createWall();
            paredDos.rotation.y=-0.5*Math.PI;
            paredDos.position.x=-50;
            paredDos.position.y=10;
            paredDos.position.z=50;
            scene.add(paredDos);

            var paredTres=createWall();
            paredTres.position.x=45;
            paredTres.position.y=10;
            paredTres.position.z=-45;
            scene.add(paredTres);

            var paredCuatro=createWall();
            paredCuatro.rotation.y=-0.5*Math.PI;
            paredCuatro.position.x=60;
            paredCuatro.position.y=10;
            paredCuatro.position.z=-25;
            scene.add(paredCuatro);
        }

        function initPortrait(){

            portraitWeight=50
            portraitHight=40
            marcoWeight=70
            marcoHight=50

            var portraitGeometry=new THREE.PlaneGeometry(portraitWeight,portraitHight,1,1);
            var portraitTexture= THREE.ImageUtils.loadTexture('imagenes/ballNeuman.png');
            var portraitMaterial = new THREE.MeshPhongMaterial({map:portraitTexture});
            var portraitMesh= new THREE.Mesh(portraitGeometry,portraitMaterial);

            var marcoGeometry=new THREE.PlaneGeometry(marcoWeight,marcoHight,1,1);
            var marcoTexture= THREE.ImageUtils.loadTexture('imagenes/marco.png');
            var marcoMaterial = new THREE.MeshPhongMaterial({map:marcoTexture,transparent:true});
            var marcoMesh= new THREE.Mesh(marcoGeometry,marcoMaterial);

            portraitMesh.rotation.y=-0.5*Math.PI;
            marcoMesh.rotation.y=-0.5*Math.PI;

            portraitMesh.position.y=55;
            marcoMesh.position.y=55;

            portraitMesh.position.x=floorWidth/2 -5;
            marcoMesh.position.x=floorWidth/2-5;

            portraitMesh.position.z=-floorHeight/2 + 120;
            marcoMesh.position.z=-floorHeight/2 + 120;
            
            scene.add(marcoMesh);
            scene.add(portraitMesh);

        }

        function initTree(){
            insertarTree(30, 15, 20, -100, 0, 70);
            insertarTree(30, 15, 25, -70, 0, 70);
        }

        function insertarTree(altura, anchoHojas,alturaHojas, x, y, z){
            var stemGeometry =new THREE.CylinderGeometry(3,3,altura,10);
            var stemTexture = THREE.ImageUtils.loadTexture('imagenes/arbol.jpg');
            var stemMaterial = new THREE.MeshPhongMaterial({map:stemTexture});;
            var stemMesh = new THREE.Mesh(stemGeometry,stemMaterial);

            var leafGeometry =new THREE.CylinderGeometry(anchoHojas,anchoHojas,alturaHojas,10);

            var leafTexture = THREE.ImageUtils.loadTexture('imagenes/hojas.jpeg');
            var leafMaterial = new THREE.MeshPhongMaterial({map:leafTexture});;

            var leafMesh = new THREE.Mesh(leafGeometry,leafMaterial);

            stemMesh.position.y=y + altura/2;
            stemMesh.position.x=x;
            stemMesh.position.z=z;

            leafMesh.position.y= y + altura;
            leafMesh.position.x=x;
            leafMesh.position.z=z;

            scene.add(stemMesh);
            scene.add(leafMesh);

        }

        function initStats() {

            var stats = new Stats();

            stats.setMode(0); // 0: fps, 1: ms

            // Align top-left
            stats.domElement.style.position = 'absolute';
            stats.domElement.style.left = '0px';
            stats.domElement.style.top = '0px';

            $("#Stats-output").append( stats.domElement );

            return stats;
        }
    });

</script>
</body>
</html>
